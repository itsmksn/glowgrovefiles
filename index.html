<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/openseadragon.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa&display=swap" rel="stylesheet"/>
  <style>
    /* ...ваші стилі, як раніше... */
    #coords-display {
      position: fixed;
      bottom: 10px; right: 10px;
      background: rgba(0,0,0,0.6);
      padding: 6px 10px;
      font-size: 14px;
      border: 1px solid white;
      border-radius: 5px;
      font-family: monospace;
      z-index: 1001;
    }
  </style>
</head>
<body>
  <button class="fullscreen-btn" id="fullscreen-btn" onclick="toggleFullscreen()">
    Повноекранна карта (може лагати)
  </button>
  <p id="date-render">Дата рендеру: 02.08.2025</p>

  <div id="openseadragon-container">
    <div id="openseadragon"></div>
  </div>
  <div id="coords-display">X: —   Z: —</div>

  <script>
    const imageWidth  = 10064;
    const imageHeight = 10064;
    const mcTL = { x: -5024, z: -5024 };
    const mcBR = { x:  5039, z:  5039 };
    const mx = mcBR.x - mcTL.x;
    const mz = mcBR.z - mcTL.z;

    const viewer = OpenSeadragon({
      id: "openseadragon",
      prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/images/",
      tileSources: "https://itsmksn.github.io/zharfiles/dzi/output.dzi",
      showNavigator: true,
      defaultZoomLevel: 1,
      minZoomLevel: 0.5,
      maxZoomLevel: 50
    });

    const coordsDisplay = document.getElementById("coords-display");

    function updateCoords(webPoint) {
      const vp = viewer.viewport.pointFromPixel(webPoint);
      const ip = viewer.viewport.viewportToImageCoordinates(vp);
      const x = Math.round(mcTL.x + (ip.x / imageWidth) * mx);
      const z = Math.round(mcTL.z + (ip.y / imageHeight) * mz);
      coordsDisplay.textContent = `X: ${x}   Z: ${z}`;
    }

    // 1) OpenSeadragon-івент
    viewer.addHandler("canvas-hover", function(evt) {
      if (evt.position) updateCoords(evt.position);
    });

    // 2) Додатково — нативний mousemove по canvas
    viewer.addHandler("open", function() {
      viewer.canvas.addEventListener("mousemove", function(e) {
        const rect = viewer.container.getBoundingClientRect();
        const webPoint = {
          x: e.clientX - rect.left,
          y: e.clientY - rect.top
        };
        updateCoords(webPoint);
      });
    });

    // Повноекранне переключення
    function toggleFullscreen() {
      const body = document.body;
      const map  = document.getElementById("openseadragon");
      const btn  = document.getElementById("fullscreen-btn");
      if (!map.classList.contains("fullscreen")) {
        map.classList.add("fullscreen");
        btn.classList.add("small");
        body.classList.add("fullscreen-mode");
      } else {
        map.classList.remove("fullscreen");
        btn.classList.remove("small");
        body.classList.remove("fullscreen-mode");
      }
    }
  </script>
</body>
</html>
